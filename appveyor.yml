version: 1.0.{build}

branches:
  only:
  - develop
  - master
skip_tags: true
clone_depth: 50

environment:
  global:
    PYTHON: C:\Python27
    PYTHON_VERSION: 2.7

install:
- cmd: >-
    set PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%

    cinst gtk-runtime
    appveyor DownloadFile "http://ftp.gnome.org/pub/GNOME/binaries/win32/pygtk/2.24/pygtk-all-in-one-2.24.2.win32-py2.7.msi"
    msiexec /i pygtk-all-in-one-2.24.2.win32-py2.7.msi /qn /norestart /log pygtk-install.log TARGETDIR=C:\Python27 ALLUSERS=1

    %PYTHON%\python.exe --version

    # Upgrade to the latest version of pip to avoid it displaying warnings
    # about it being out of date.  Also upgrade setuptools and wheel.
    %PYTHON%\python.exe -m pip install -U pip setuptools>12.0 wheel
    %PYTHON%\python.exe -m pip install --only-binary=numpy numpy==1.14.3
    %PYTHON%\python.exe -m pip install --only-binary=scipy scipy==1.0.0
    %PYTHON%\python.exe -m pip install coverage==4.0.3
    %PYTHON%\python.exe -m pip install -r requirements_run.txt
    %PYTHON%\python.exe -m pip install -r requirements_dev.txt
    %PYTHON%\python.exe -m pip install matplotlib==1.4.3
    %PYTHON%\python.exe setup.py install

test_script:
- cmd: >-
    %PYTHON%\python.exe setup.py test

after_test:
- cmd: >-
    %PYTHON%\python.exe setup.py bdist_wheel
    %PYTHON%\python.exe setup.py bdist_wininst
    %PYTHON%\python.exe setup.py bdist_msi

cache: pygtk-all-in-one-2.24.2.win32-py2.7.msi

artifacts:
- path: dist\*
