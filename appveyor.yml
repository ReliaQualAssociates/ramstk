version: 1.0.{build}
pull_requests:
  do_not_increment_build_number: true
branches:
  only:
  - master
  - develop
skip_branch_with_pr: true
platform: x86
shallow_clone: true
environment:
  PYTHON: C:\Python37
  PYTHON_VERSION: 3.7
  VENV_BUILD_DIR: venv_build
  VENV_TEST_DIR: venv_test
install:
- cmd: >-
    set PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%

    %PYTHON%\python.exe -m pip install -U pip

    %PYTHON%\python.exe -m pip install -U virtualenv

    virtualenv --version
build_script:
- cmd: >-
    virtualenv --system-site-packages --clear %VENV_BUILD_DIR%

    %VENV_BUILD_DIR%\\Scripts\\activate.bat

    python -m pip install -U pip setuptools>12.0 wheel

    python -m pip install --only-binary=numpy numpy==1.16.3

    python -m pip install --only-binary=scipy scipy==1.2.1

    python -m pip install coverage==4.5.3

    python -m pip install -r requirements_run.txt

    python -m pip install -r requirements_dev.txt

    python setup.py bdist_wheel

    python setup.py bdist_wininst

    python setup.py bdist_msi

    dir dist

    %VENV_BUILD_DIR%\\Scripts\\deactivate.bat

    rmdir %VENV_BUILD_DIR% /s /q
test_script:
- cmd: >-
    virtualenv --system-site-packages --clear %VENV_TEST_DIR%

    %VENV_TEST_DIR%\\Scripts\\activate.bat

    python -m pip install -U pip setuptools>12.0 wheel

    python -m pip install --only-binary=numpy numpy==1.16.3

    python -m pip install --only-binary=scipy scipy==1.2.1

    python -m pip install coverage==4.5.3

    python -m pip install -r requirements_run.txt

    python -m pip install -r requirements_dev.txt

    pip install --pre --no-index --find-links dist/ RAMSTK

    python setup.py test

    %VENV_TEST_DIR%\\Scripts\\deactivate.bat

    rmdir %VENV_TEST_DIR% /s /q
artifacts:
- path: dist\*
